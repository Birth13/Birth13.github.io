---
title: 사각형 렌더러 수정(출력 오류)
date: 2025-07-25 19:00:00 +09:00
categories: [BEngine]
tags: [C++, Winapi]
---

---
# 출력 오류를 수정해보자.
&nbsp;플레인 매쉬를 추가한 후에<br>
카메라를 돌려가며 그냥 매쉬를 구경하고 있었는데,<br>
아무것도 그려지지 말아야 하는 화면에<br>
무언가가 그려지는 것을 확인하였다.<br>
<br>&nbsp;어떤 조건에서 발생하는 것인지는 파악하지 못하여서<br>
어느 부분에서 잘 발생하나 찾아보니<br>
중앙에 있는 플레인 매쉬가 near z에 의해 클리핑 되는 순간에<br>
카메라를 돌리면 잘 보이는 것을 발견하였다.<br>
<br>&nbsp;아래는 증상에 대한 이미지이다.

![main_window - FPS _ 60 2025-07-25 19-22-41](https://github.com/user-attachments/assets/88548556-0b5d-40c4-8ef3-4aeae631696d)

<br><br><br>&nbsp;대체 왜 이런 증상이 발생하는가<br>
원인을 찾아보다가<br>
의심되는 부분을 발견하였다.<br>
<br>&nbsp;아래는 의심이 시작된 코드이다.

```cpp
			// 클립 공간 좌표계에서 NDC(Normalized Device Coordinates)로 변환
			vertex_info.position = { position.x / position.w, position.y / position.w , position.z / position.w };
```

&nbsp;RectRenderer의 Render_Object() 함수 일부분이다.<br>
<br>&nbsp;주석에 쓰여있는 대로 클립 공간 좌표계에서 NDC로 변환하기 위해<br>
위치 좌표를 w값으로 나누어주는 코드이다.
<br>&nbsp;그런데 출력되지 말아야 할 오브젝트의 점에서<br>
w값이 음수였기에 점의 위치가 원점을 기준으로 반전된 것이었다.<br>
<br>&nbsp;이 부분을 수정해주니 증상이 사라졌다.<br>
<br>&nbsp;아래는 수정된 코드이다.

```cpp
			// 클립 공간 좌표계에서 NDC(Normalized Device Coordinates)로 변환
			if (position.w > 0.0f) {	// 양수만 처리하여 부호 바꾸기를 방지
				vertex_info.position = { position.x / position.w, position.y / position.w , position.z / position.w };
			}
```

&nbsp;그리고 아래는 증상이 해결된 결과 이미지이다.

![main_window - FPS _ 60 2025-07-25 19-24-54](https://github.com/user-attachments/assets/08800ed7-88d0-4be9-b348-fcf34096987c)

<br><br><br>&nbsp;원래는 이미지 파일을 읽어서 비트맵에 저장하는 기능을 추가하려고 했는데<br>
위와 같은 버그를 발견하게 되어 이를 먼저 해결하게 되었다.<br>
<br>&nbsp;이전에 세운 계획에 따라 BEngine에 대한 글은 한동안 쉴 예정이다.<br>
<br>&nbsp;글을 다시 작성하기 시작할 때 첫 글은 아마 이미지 로드가 아닐까 싶다.
